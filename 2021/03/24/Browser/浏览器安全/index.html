<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>浏览器安全 | 记录成长的每一步</title><meta name="keywords" content="同源策略,XSS,CSRF,CORS,CSP"><meta name="author" content="Momento"><meta name="copyright" content="Momento"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="浏览器安全  一、Web页面安全  1. 为什么Web页面需要安全策略？ 因为如果在没有安全保障的Web世界中，我们是没有隐私的，所以需要安全策略来保障我们的隐私和数据的安全。 比如说，如果Web页面没有安全策略，那么当你打开一个银行站点，然后又一不小心打开了一个恶意的站点，那么恶意站点可以做许多事情：  修改银行站点的DOM，CSSOM等信息 在银行站点内部插入JavaScript脚本 劫持用">
<meta property="og:type" content="article">
<meta property="og:title" content="浏览器安全">
<meta property="og:url" content="http://example.com/2021/03/24/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8/index.html">
<meta property="og:site_name" content="记录成长的每一步">
<meta property="og:description" content="浏览器安全  一、Web页面安全  1. 为什么Web页面需要安全策略？ 因为如果在没有安全保障的Web世界中，我们是没有隐私的，所以需要安全策略来保障我们的隐私和数据的安全。 比如说，如果Web页面没有安全策略，那么当你打开一个银行站点，然后又一不小心打开了一个恶意的站点，那么恶意站点可以做许多事情：  修改银行站点的DOM，CSSOM等信息 在银行站点内部插入JavaScript脚本 劫持用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2021-03-23T16:07:51.081Z">
<meta property="article:modified_time" content="2021-04-18T07:26:18.708Z">
<meta property="article:author" content="Momento">
<meta property="article:tag" content="同源策略">
<meta property="article:tag" content="XSS">
<meta property="article:tag" content="CSRF">
<meta property="article:tag" content="CORS">
<meta property="article:tag" content="CSP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/03/24/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-04-18 15:26:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}const fontSizeVal = saveToLocal.get('global-font-size')
if (fontSizeVal !== undefined) {
  document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
}})()</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">记录成长的每一步</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">浏览器安全</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-03-23T16:07:51.081Z" title="发表于 2021-03-24 00:07:51">2021-03-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-04-18T07:26:18.708Z" title="更新于 2021-04-18 15:26:18">2021-04-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8/">浏览器</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="浏览器安全"><a class="markdownIt-Anchor" href="#浏览器安全"></a> 浏览器安全</h1>
<h2 id="一-web页面安全"><a class="markdownIt-Anchor" href="#一-web页面安全"></a> 一、Web页面安全</h2>
<h3 id="1-为什么web页面需要安全策略"><a class="markdownIt-Anchor" href="#1-为什么web页面需要安全策略"></a> 1. 为什么Web页面需要安全策略？</h3>
<p>因为如果在没有安全保障的Web世界中，我们是没有隐私的，所以需要安全策略来保障我们的隐私和数据的安全。</p>
<p>比如说，如果Web页面没有安全策略，那么当你打开一个银行站点，然后又一不小心打开了一个恶意的站点，那么恶意站点可以做许多事情：</p>
<ul>
<li>修改银行站点的DOM，CSSOM等信息</li>
<li>在银行站点内部插入JavaScript脚本</li>
<li>劫持用户登录的用户名和密码</li>
<li>读取银行站点的Cookie、LocalStorage和IndexedDB等数据</li>
<li>将这些信息上传至自己的服务器，这样就可以在你不知情的情况下伪造一些转账请求信息</li>
</ul>
<p>这就引出了Web页面中最基本、最核心的安全策略——同源策略（Same-origin policy）。</p>
<h3 id="2-同源策略same-origin-policy"><a class="markdownIt-Anchor" href="#2-同源策略same-origin-policy"></a> 2. 同源策略（Same-origin policy）</h3>
<p>同源：如果两个URL的<strong>协议</strong>、<strong>域名</strong>和<strong>端⼝号</strong>都相同，我们就称这两个URL同源。</p>
<p>同源策略：浏览器默认两个相同的源之间是可以相互访问资源和操作DOM的。两个不同的源之间若想要相互访问资源或者操作DOM，那么会有一套基础的安全策略的制约，这个安全策略就是同源策略。</p>
<p>同源策略主要表现在<strong>DOM</strong>、<strong>Web数据</strong>和<strong>网络</strong>三个层面。</p>
<ol>
<li>
<p>DOM层面</p>
<p><strong>同源策略限制了来自不同源的JS脚本对当前DOM对象读和写的操作</strong>。例如：</p>
<ul>
<li>从一个页面打开同源的另一个页面，第二个页面可以通过<code>opener.document</code>来获取同源页面（第一个页面）的DOM（opener：返回打开当前窗口的那个窗口的引用，也就是指向第一个页面的window对象）</li>
<li>从一个页面打开不同源的另一个页面，第二个页面是无法操作第一个页面的DOM</li>
</ul>
</li>
<li>
<p>数据层面</p>
<p><strong>同源策略限制了不同源的站点读取当前站点的Cookie、LocalStorage、IndexedDB等数据。</strong></p>
<p>同源的站点之间可以访问公共的数据，不同源之间是无法访问的。</p>
</li>
<li>
<p>网络层面</p>
<p><strong>同源策略限制了通过XMLHttpRequest、Fetch等方式将站点的数据发送给不同源的站点。</strong></p>
</li>
</ol>
<h3 id="3-浏览器出让的安全性"><a class="markdownIt-Anchor" href="#3-浏览器出让的安全性"></a> 3. 浏览器出让的安全性</h3>
<p>安全性和便利性是相对的，让不同的源之间完全隔离，毫无疑问是绝对安全的措施，但这也使得Web项目难以开发和使用。所以浏览器出让了一些安全性来满足便利性，使二者之间能有个权衡。</p>
<h4 id="1-页面中可以嵌入第三方资源"><a class="markdownIt-Anchor" href="#1-页面中可以嵌入第三方资源"></a> (1) 页面中可以嵌入第三方资源</h4>
<p>由于同源策略的限制，要让一个页面的资源全部都来自于一个源，也就是要将所有HTML、CSS、JS、图片等资源都部署到一台服务器上，那么就无法将一些资源部署到CDN上，所以浏览器为页面中引用资源开了一个&quot;口子&quot;，让其引用外部文件。</p>
<p>比如说，我们可以通过<code>&lt;img&gt;</code>的<code>href</code>属性来获取图片资源，通过<code>&lt;script&gt;</code>、<code>&lt;link&gt;</code>的<code>src</code>属性来获取JS和CSS资源。</p>
<p>但是，这也带来了很多危害，比如说HTML被恶意程序劫持，同时向其中插入了恶意的JS脚本。当页面被加载时，恶意的JS脚本运行，可能会将页面的敏感数据，如Cookie、LocalStorage、IndexedDB通过<code>XSS</code>的手段发送给服务器。</p>
<p>为了解决XSS攻击，浏览器引入了<strong>内容安全策略（Content Security Policy，CSP）</strong>。</p>
<p>CSP的核心思想是让服务器决定浏览器能够加载哪些资源，让服务器决定浏览器是否能够执行内联的JS代码，以此来减少XSS攻击。</p>
<h5 id="jsonp跨域"><a class="markdownIt-Anchor" href="#jsonp跨域"></a> JSONP跨域</h5>
<ol>
<li>添加一个<code>&lt;script&gt;</code>元素，请求的URL携带一个<code>callback</code>查询参数(<code>?callback=bar</code>)</li>
<li>服务器收到请求后，拼接一个字符串，将 JSON 数据放在函数名里面，作为字符串返回(<code>bar(&#123;...&#125;)</code>)</li>
<li>客户端只要定义了<code>bar()</code>函数，就能在该函数体内，拿到服务器返回的 JSON 数据。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonp</span>(<span class="params">&#123; url, params, cb &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> script = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>)</span><br><span class="line">    <span class="built_in">window</span>[cb] = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      resolve(data)</span><br><span class="line">      <span class="built_in">document</span>.body.removeChild(script)</span><br><span class="line">    &#125;</span><br><span class="line">    params = &#123; ...params, cb &#125;</span><br><span class="line">    <span class="keyword">const</span> arr = []</span><br><span class="line">    <span class="built_in">Reflect</span>.ownKeys(params).forEach(<span class="function"><span class="params">key</span> =&gt;</span> arr.push(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;params[key]&#125;</span>`</span>))</span><br><span class="line">    script.src = <span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;arr.join(<span class="string">&quot;&amp;&quot;</span>)&#125;</span>`</span></span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(script)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://www.example.com/sug?prod=pc&amp;wd=ab&amp;cb=callback</span></span><br><span class="line">jsonp(&#123;</span><br><span class="line">  url: <span class="string">&quot;https://www.example.com/sug&quot;</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    prod: <span class="string">&quot;pc&quot;</span>,</span><br><span class="line">    wd: <span class="string">&quot;ab&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  cb: <span class="string">&quot;callback&quot;</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/sug&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; cb &#125; = req.query</span><br><span class="line">  res.send(<span class="string">`<span class="subst">$&#123;cb&#125;</span>(&quot;data&quot;)`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2-跨域资源共享cors"><a class="markdownIt-Anchor" href="#2-跨域资源共享cors"></a> (2) 跨域资源共享（CORS）</h4>
<p>由于同源策略的限制，两个不同源的站点之间是无法使用XMLHttpRequest和Fetch发送请求的，而在实际应用中，这会大大制约我们的生产力，为了解决这个问题，浏览器引入了**跨域资源共享（Cross Origin Resources Sharing，CORS）**机制，使用CORS机制可以进行跨域访问控制，从而使跨域传输数据得以安全进行。</p>
<h5 id="cors机制的工作原理"><a class="markdownIt-Anchor" href="#cors机制的工作原理"></a> CORS机制的工作原理</h5>
<p>CORS把HTTP请求分为两种请求，一种是<strong>简单请求</strong>，另一种是<strong>非简单请求</strong>。</p>
<h5 id="1-简单请求"><a class="markdownIt-Anchor" href="#1-简单请求"></a> ① 简单请求</h5>
<p>简单请求也就是简单的请求方法，简单的请求头信息。</p>
<ul>
<li>请求方法是：GET、POST、HEAD之一</li>
<li>请求头字段：
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Content-Type：text/plain、multipart/form-data、application/x-www-form-urlencoded 之一</li>
</ul>
</li>
</ul>
<p>对于简单请求，浏览器直接发出CORS请求。</p>
<p>浏览器在发送请求的时候会自动加上<code>Origin</code>头字段，表明本次请求来自哪个域。</p>
<p>服务器在响应请求时，如果未携带响应头<code>Access-Control-Allow-Origin</code>字段，则浏览器就知道出错了。</p>
<h5 id="2-非简单请求"><a class="markdownIt-Anchor" href="#2-非简单请求"></a> ② 非简单请求</h5>
<p>非简单请求也就是特殊的请求方法，特殊的请求头信息。</p>
<h6 id="1-预检请求"><a class="markdownIt-Anchor" href="#1-预检请求"></a> 1. 预检请求</h6>
<p>在正式发起请求之前，浏览器会发送一个<code>OPTIONS</code>的<strong>预检请求</strong>。</p>
<p>预检请求中同时携带了<code>Origin</code>、<code>Access-Control-Request-Method</code>和<code>Access-Control-Request-Headers</code>头字段，告知服务器正式请求的域名、请求方法和请求头字段。</p>
<p>服务器依据这些字段来决定正式请求是否被允许，然后响应这个预检请求，同时携带响应头<code>Access-Control-Allow-Origin</code>、<code>Access-Control-Allow-Methods</code>和<code>Accss-Control-Allow-Headers</code>字段，告知浏览器正式请求可以使用的域名、请求方法和请求头字段。</p>
<p>当响应携带<code>Access-Control-Max-Age</code>头字段时，告诉浏览器这个预检请求的有效期为多少秒，也就是说下次同样的请求，如果在有效期内，浏览器就不需要再发起预检请求。</p>
<h6 id="2-正式请求"><a class="markdownIt-Anchor" href="#2-正式请求"></a> 2. 正式请求</h6>
<p>一旦服务器通过了预检请求之后，浏览器就可以发送正式请求，就跟简单请求一样。</p>
<h4 id="3-跨文档消息机制"><a class="markdownIt-Anchor" href="#3-跨文档消息机制"></a> (3) 跨文档消息机制</h4>
<p>由于同源策略的限制，两个不同源的页面是无法互相操作DOM的，而在实际应用中，可能需要两个不同源的DOM之间进行通信，所以浏览器又引入了跨文档消息机制，可以通过<code>window.postMessage</code>的API来和不同源的DOM之间进行比较安全的通信。</p>
<h3 id="2-xss攻击"><a class="markdownIt-Anchor" href="#2-xss攻击"></a> 2. XSS攻击</h3>
<h4 id="1-什么是xss"><a class="markdownIt-Anchor" href="#1-什么是xss"></a> (1) 什么是XSS</h4>
<p>XSS(Cross-site Scripting)，跨站脚本，为了与“CSS”区分开，故简称XSS。</p>
<p>XSS攻击指攻击者往HTML文件或者DOM中注入恶意脚本，从而使用户浏览页面时利用注入的恶意脚本对用户实施攻击的一种手段。</p>
<h4 id="2-xss的危害"><a class="markdownIt-Anchor" href="#2-xss的危害"></a> (2) XSS的危害</h4>
<p>当HTML被注入了恶意的JS脚本时，浏览器是无法区分这些脚本是恶意的，所以恶意的脚本也拥有了其他脚本的权限。比如：</p>
<ul>
<li>
<p>窃取Cookie</p>
<p>恶意JS脚本可以通过<code>document.cookie</code>获取cookie信息，然后通过XMLHttpRequest或Fetch加上CORS将数据发送给恶意服务器。恶意服务器拿到用户的Cookie信息后，就可以在其他电脑上模拟用户的登录，然后进行一些恶意操作。</p>
</li>
<li>
<p>监听用户行为</p>
<p>恶意JS脚本可以通过<code>addEventListener</code>来监听键盘事件，比如获取用户输入的隐私信息，将其发送给恶意服务器。恶意服务器拿到用户输入的隐私信息后，可以进行一些恶意操作。</p>
</li>
<li>
<p>修改DOM</p>
<p>恶意JS脚本可以修改DOM来伪造假的登录窗口，用来窃取用户输入的用户名和密码等隐私信息。</p>
<p>同时还有可能添加浮窗广告，严重影响用户体验。</p>
</li>
</ul>
<p>总之，如果让页面插入了恶意脚本，那么就相当于把页面的隐私数据和行为完全暴露给了外界。</p>
<h4 id="3-恶意脚本注入"><a class="markdownIt-Anchor" href="#3-恶意脚本注入"></a> (3) 恶意脚本注入</h4>
<p>通常情况下，XSS攻击主要分为<strong>存储型XSS攻击</strong>、<strong>反射型XSS攻击</strong>和<strong>基于DOM的XSS攻击</strong>三种方式注入恶意脚本。</p>
<h5 id="1-存储型xss攻击"><a class="markdownIt-Anchor" href="#1-存储型xss攻击"></a> ① 存储型XSS攻击</h5>
<ol>
<li>首先，攻击者利用站点漏洞将一段恶意JS代码提交到保存网站数据的数据库中</li>
<li>然后，用户访问了包含恶意JS代码的页面</li>
<li>最后，用户浏览该页面的时候，恶意JS代码运行，将用户的隐私数据上传到恶意服务器</li>
</ol>
<h5 id="2-反射型xss攻击"><a class="markdownIt-Anchor" href="#2-反射型xss攻击"></a> ② 反射型XSS攻击</h5>
<ol>
<li>首先，攻击者将一段还有恶意代码的请求提交给Web服务器</li>
<li>然后，Web服务器接收到请求后，又将恶意代码反射给了浏览器端</li>
</ol>
<p>反射型和存储型的不同之处在于，Web服务器不会存储反射型的恶意脚本</p>
<h5 id="3-基于dom的xss攻击"><a class="markdownIt-Anchor" href="#3-基于dom的xss攻击"></a> ③ 基于DOM的XSS攻击</h5>
<p>基于DOM的XSS攻击是不牵涉到Web服务器的。攻击者通过各种手段将恶意脚本注入页面，比如通过网络劫持在页面传输过程中修改HTML的内容</p>
<h4 id="4-xss预防"><a class="markdownIt-Anchor" href="#4-xss预防"></a> (4) XSS预防</h4>
<p>无论是何种类型的XSS攻击，他们的共同点都是往浏览器中的页面注入恶意脚本，然后通过恶意脚本将用户信息发送至恶意服务器。所以，要阻止XSS攻击，可以通过<strong>阻止恶意JS脚本的注入和恶意消息的发送</strong>来实现。</p>
<h5 id="1-过滤或转码"><a class="markdownIt-Anchor" href="#1-过滤或转码"></a> ① 过滤或转码</h5>
<p>不管是存储型还是反射型XSS攻击，我们都可以在服务端将一些关键字符进行转码或过滤。</p>
<p>比如：</p>
<ul>
<li>把<code>&lt;script&gt;...&lt;/script&gt;</code>整个都给过滤掉</li>
<li>把<code>&lt;&gt;</code>转码为<code>&amp;lt;&amp;gt;</code></li>
</ul>
<h5 id="2-充分利用csp"><a class="markdownIt-Anchor" href="#2-充分利用csp"></a> ② 充分利用CSP</h5>
<p>仅仅只是依靠服务端执行过滤和转码是不够的，我们还需要把CSP策略充分利用进来，以此来大大减少XSS危险。</p>
<p>CSP大致功能：</p>
<ul>
<li>禁止像第三方域提交数据，这样可以防止用户数据泄露</li>
<li>禁止执行内联脚本和未授权的脚本</li>
<li>限制加载其他域下的资源文件，这样即使被注入了恶意脚本，脚本也是不会被加载的</li>
<li>提供上报XSS机制，可以帮助我们尽快发现有哪些XSS攻击</li>
</ul>
<h5 id="3-使用httponly属性"><a class="markdownIt-Anchor" href="#3-使用httponly属性"></a> ③ 使用HttpOnly属性</h5>
<p>很多XSS攻击都会盗用Cookie，所以我们还可以通过<code>HttpOnly</code>属性来保护Cookie的安全。</p>
<p>服务器在设置<code>set-cookie</code>头字段时，可以用HttpOnly属性来标记这个字段，表名该cookie只能在http请求过程中使用，无法通过JS脚本获取到该cookie。</p>
<h3 id="3-csrf攻击"><a class="markdownIt-Anchor" href="#3-csrf攻击"></a> 3. CSRF攻击</h3>
<h4 id="1-什么是csrf以及危害"><a class="markdownIt-Anchor" href="#1-什么是csrf以及危害"></a> (1) 什么是CSRF以及危害</h4>
<p>CSRF(Cross-site request forgery)，跨站请求伪造。</p>
<p>CSRF攻击指攻击者引诱用户打开攻击者部署的网站，在攻击者的网站中，利用用户的登录状态发起跨站请求。</p>
<p>攻击者可以利用用户的登录状态来做一些转账等恶意操作。</p>
<h4 id="2-csrf攻击方式"><a class="markdownIt-Anchor" href="#2-csrf攻击方式"></a> (2) CSRF攻击方式</h4>
<p>CSRF攻击的三个必要条件：</p>
<ol>
<li>目标站点必须有CSRF漏洞</li>
<li>用户登录过目标站点，并且在浏览器上保持着该站点的登录状态</li>
<li>需要用户打开另一个第三方站点</li>
</ol>
<p>比如说：当用户登录并访问了https://example.com，在没有登出的情况下，打开了恶意的网站后，攻击者通常有3种方式来实时CSRF攻击：</p>
<h5 id="1-自动发起get请求"><a class="markdownIt-Anchor" href="#1-自动发起get请求"></a> ① 自动发起get请求</h5>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://example.com/sendcoin?user=hacker&amp;number=100&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当该页面加载时，浏览器认为这是一张图片，会对这个链接发起get请求，如果服务器没有对请求做判断的话，那么服务器就会认为这是一个正常的请求，执行转账操作。</p>
<h5 id="2-自动发起post请求"><a class="markdownIt-Anchor" href="#2-自动发起post请求"></a> ② 自动发起post请求</h5>
<p>有些接口可能使用的post请求，但是攻击者同样可以利用form表单发起post请求。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&#x27;hacker-form&#x27;</span> <span class="attr">action</span>=<span class="string">&quot;https://time.geekbang.org/sendcoin&quot;</span> <span class="attr">method</span>=<span class="string">POST</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hacker&quot;</span> /&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;number&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"> <span class="built_in">document</span>.getElementById(<span class="string">&#x27;hacker-form&#x27;</span>).submit(); </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当页面加载时，浏览器会自动触发这个隐藏表单域的提交事件，同样的，如果服务器没有对该请求做判断的话，那么服务器也会认为这是一个正常请求，执行转账操作。</p>
<h5 id="3-引诱用户点击链接"><a class="markdownIt-Anchor" href="#3-引诱用户点击链接"></a> ③ 引诱用户点击链接</h5>
<p>除了用户自己去浏览恶意网站，我们还可以通过诱导的方式，比如邮件或者论坛等方式，诱导用户点击恶意的链接，跳转到恶意的网站，执行转账等恶意操作。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">width</span>=<span class="string">150</span> <span class="attr">src</span>=<span class="string">http://images.xxx.cn/xxx.jpg</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://example.com/sendcoin?user=hacker&amp;number=100&quot;</span>&gt;</span> </span><br><span class="line">    点击下载美⼥照⽚</span><br><span class="line">	<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-csrf与xss的区别"><a class="markdownIt-Anchor" href="#3-csrf与xss的区别"></a> (3) CSRF与XSS的区别</h4>
<p>CSRF与XSS攻击相比，并不需要向页面注入恶意代码，仅仅只需要利用服务器的漏洞和用户的登录状态来实时攻击，</p>
<p>所以CSRF攻击是无法获取用户页面的数据的。</p>
<h4 id="4-csrf预防"><a class="markdownIt-Anchor" href="#4-csrf预防"></a> (4) CSRF预防</h4>
<p>通过CSRF攻击的3个条件，我们能发现一个关。键点就是<strong>目标站点的服务器有漏洞</strong>，所以对于CSRF攻击，我们主要的防范手段就是提升服务器的安全性。</p>
<h5 id="1-利用cookie的samesite属性"><a class="markdownIt-Anchor" href="#1-利用cookie的samesite属性"></a> ① 利用Cookie的SameSite属性</h5>
<p>Cookie是浏览器和服务器之间维护用户登录状态的一个关键数据，要防止CSRF攻击，我们最好可以实现从第三方站点发送请求时禁止携带Cookie。</p>
<p>服务器在响应头中添加<code>set-cookie</code>头字段时，给这个cookie设置SameSite属性，SameSite属性有3个值</p>
<ul>
<li>Strict：严格，完全禁止第三方站点请求时携带该Cookie</li>
<li>Lax：较为宽松，只有在第三方站点使用像<code>&lt;a&gt;</code>链接和<strong>GET表单</strong>时可以携带Cookie</li>
<li>None：任何情况下都可以携带</li>
</ul>
<p>通过Cookie的<strong>SameSite</strong>属性，就可以很好的解决这个问题。可以将一些关键的Cookie设置为Strict或者Lax，这样在跨站请求的时候，这些Cookie就不会被携带了。</p>
<h5 id="2-验证请求的来源站点"><a class="markdownIt-Anchor" href="#2-验证请求的来源站点"></a> ② 验证请求的来源站点</h5>
<p>由于CSRF攻击大多来自于第三方站点，因此服务器可以完全拒绝第三方站点的请求。</p>
<p>通过HTTP请求头中的<code>Referer</code>和<code>Origin</code>字段可以判断请求的来源。</p>
<ul>
<li>Referer：记录了HTTP请求的来源地址。有些场景并不适合将请求来源的URL暴露给服务器，因此提供了一个Referrer Policy选项来管理Referrer。</li>
<li>Origin：记录了HTTP请求的来源域名。由于Referer并不是太可靠，所有有了另一个可靠的属性，那就是Origin，Origin只包含了域名信息，并不会携带后面的URL路径信息，这也是和Referrer的一个主要区别。在一些场合下，比如XMLHttpRequest、Fetch发起请求时，会自动带上Origin这个头字段。</li>
</ul>
<p>所以，通常，服务器的优先策略是优先判断Origin，如果没有Origin属性，在根据实际情况判断是否需要使用Referer。</p>
<h5 id="3-csrf-token验证"><a class="markdownIt-Anchor" href="#3-csrf-token验证"></a> ③ CSRF Token验证</h5>
<p>CSRF Token验证大致分为2个步骤：</p>
<ol>
<li>浏览器向服务器发送请求时，服务器生成一个CSRF Token(一个复杂的字符串)返回给浏览器。</li>
<li>浏览器在发起一些重要的请求时，需要带上这个CSRF Token，然后服务器会验证这个Token是否合法，。如果是从第三方站点发出的请求，那么是无法获取到CSRF Token的，所以即使第三方发起了请求，也会因为没有CSRF Token而拒绝这个请求的。</li>
</ol>
<h2 id="二-浏览器网络安全"><a class="markdownIt-Anchor" href="#二-浏览器网络安全"></a> 二、浏览器网络安全</h2>
<p>// TODO</p>
<h2 id="三-浏览器系统安全"><a class="markdownIt-Anchor" href="#三-浏览器系统安全"></a> 三、浏览器系统安全</h2>
<p>// TODO</p>
<h2 id="参考链接"><a class="markdownIt-Anchor" href="#参考链接"></a> 参考链接</h2>
<ul>
<li>
<p>李兵《图解 Google V8》：<a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100048001">https://time.geekbang.org/column/intro/100048001</a></p>
</li>
<li>
<p>MDN - XSS: <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Cross-site_scripting">https://developer.mozilla.org/zh-CN/docs/Glossary/Cross-site_scripting</a></p>
</li>
<li>
<p>MDN - CORS: <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS</a></p>
</li>
<li>
<p>MDN - CSP: <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP</a></p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Momento</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/03/24/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8/">http://example.com/2021/03/24/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">记录成长的每一步</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/">同源策略</a><a class="post-meta__tags" href="/tags/XSS/">XSS</a><a class="post-meta__tags" href="/tags/CSRF/">CSRF</a><a class="post-meta__tags" href="/tags/CORS/">CORS</a><a class="post-meta__tags" href="/tags/CSP/">CSP</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2021/03/16/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84JavaScript%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">浏览器中的JavaScript执行机制</div></div></a></div></nav></div><div class="aside_content" id="aside_content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8"><span class="toc-text"> 浏览器安全</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-web%E9%A1%B5%E9%9D%A2%E5%AE%89%E5%85%A8"><span class="toc-text"> 一、Web页面安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88web%E9%A1%B5%E9%9D%A2%E9%9C%80%E8%A6%81%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5"><span class="toc-text"> 1. 为什么Web页面需要安全策略？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5same-origin-policy"><span class="toc-text"> 2. 同源策略（Same-origin policy）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%87%BA%E8%AE%A9%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-text"> 3. 浏览器出让的安全性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%A1%B5%E9%9D%A2%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%B5%8C%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E8%B5%84%E6%BA%90"><span class="toc-text"> (1) 页面中可以嵌入第三方资源</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#jsonp%E8%B7%A8%E5%9F%9F"><span class="toc-text"> JSONP跨域</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%ABcors"><span class="toc-text"> (2) 跨域资源共享（CORS）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#cors%E6%9C%BA%E5%88%B6%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text"> CORS机制的工作原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82"><span class="toc-text"> ① 简单请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%9D%9E%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82"><span class="toc-text"> ② 非简单请求</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E9%A2%84%E6%A3%80%E8%AF%B7%E6%B1%82"><span class="toc-text"> 1. 预检请求</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E6%AD%A3%E5%BC%8F%E8%AF%B7%E6%B1%82"><span class="toc-text"> 2. 正式请求</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%B7%A8%E6%96%87%E6%A1%A3%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6"><span class="toc-text"> (3) 跨文档消息机制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-xss%E6%94%BB%E5%87%BB"><span class="toc-text"> 2. XSS攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AFxss"><span class="toc-text"> (1) 什么是XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-xss%E7%9A%84%E5%8D%B1%E5%AE%B3"><span class="toc-text"> (2) XSS的危害</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%81%B6%E6%84%8F%E8%84%9A%E6%9C%AC%E6%B3%A8%E5%85%A5"><span class="toc-text"> (3) 恶意脚本注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AD%98%E5%82%A8%E5%9E%8Bxss%E6%94%BB%E5%87%BB"><span class="toc-text"> ① 存储型XSS攻击</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%8F%8D%E5%B0%84%E5%9E%8Bxss%E6%94%BB%E5%87%BB"><span class="toc-text"> ② 反射型XSS攻击</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%9F%BA%E4%BA%8Edom%E7%9A%84xss%E6%94%BB%E5%87%BB"><span class="toc-text"> ③ 基于DOM的XSS攻击</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-xss%E9%A2%84%E9%98%B2"><span class="toc-text"> (4) XSS预防</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%BF%87%E6%BB%A4%E6%88%96%E8%BD%AC%E7%A0%81"><span class="toc-text"> ① 过滤或转码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%85%85%E5%88%86%E5%88%A9%E7%94%A8csp"><span class="toc-text"> ② 充分利用CSP</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8httponly%E5%B1%9E%E6%80%A7"><span class="toc-text"> ③ 使用HttpOnly属性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-csrf%E6%94%BB%E5%87%BB"><span class="toc-text"> 3. CSRF攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AFcsrf%E4%BB%A5%E5%8F%8A%E5%8D%B1%E5%AE%B3"><span class="toc-text"> (1) 什么是CSRF以及危害</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-csrf%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-text"> (2) CSRF攻击方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%87%AA%E5%8A%A8%E5%8F%91%E8%B5%B7get%E8%AF%B7%E6%B1%82"><span class="toc-text"> ① 自动发起get请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%87%AA%E5%8A%A8%E5%8F%91%E8%B5%B7post%E8%AF%B7%E6%B1%82"><span class="toc-text"> ② 自动发起post请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%BC%95%E8%AF%B1%E7%94%A8%E6%88%B7%E7%82%B9%E5%87%BB%E9%93%BE%E6%8E%A5"><span class="toc-text"> ③ 引诱用户点击链接</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-csrf%E4%B8%8Exss%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text"> (3) CSRF与XSS的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-csrf%E9%A2%84%E9%98%B2"><span class="toc-text"> (4) CSRF预防</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%A9%E7%94%A8cookie%E7%9A%84samesite%E5%B1%9E%E6%80%A7"><span class="toc-text"> ① 利用Cookie的SameSite属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%AA%8C%E8%AF%81%E8%AF%B7%E6%B1%82%E7%9A%84%E6%9D%A5%E6%BA%90%E7%AB%99%E7%82%B9"><span class="toc-text"> ② 验证请求的来源站点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-csrf-token%E9%AA%8C%E8%AF%81"><span class="toc-text"> ③ CSRF Token验证</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8"><span class="toc-text"> 二、浏览器网络安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8"><span class="toc-text"> 三、浏览器系统安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-text"> 参考链接</span></a></li></ol></li></ol></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Momento</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>